<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HindTrade | Global Enterprise OS</title>
    <link rel="icon" type="image/svg+xml" href="assets/images/logo.svg">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@200;300;400;500;600;700&display=swap" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="assets/js/supabase-config.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Manrope', 'sans-serif'] },
                    colors: {
                        void: '#050505',
                        surface: '#0A0A0A',
                        border: '#1F1F1F',
                        gold: {
                            100: '#F5E6C8',
                            400: '#C5A059',
                            500: '#B08D55',
                            900: '#423318'
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.4s ease-out forwards',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #050505; color: #E5E5E5; }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: #050505; }
        ::-webkit-scrollbar-thumb { background: #1F1F1F; border-radius: 2px; }
        
        .glass {
            background: rgba(10, 10, 10, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.03);
        }
        
        .glow-gold { box-shadow: 0 0 50px -15px rgba(197, 160, 89, 0.15); }
        .nav-item.active { background: rgba(197, 160, 89, 0.05); border-left: 2px solid #C5A059; color: #F5E6C8; }
        .blur-secret { color: transparent; text-shadow: 0 0 10px rgba(255,255,255,0.4); user-select: none; }

        .edit-input {
            background: rgba(255, 255, 255, 0.05);
            border: none;
            border-bottom: 2px solid #C5A059;
            color: white;
            padding: 2px 8px;
            outline: none;
            width: 100%;
            font-family: inherit;
        }

        .agent-frame {
            border: none;
            width: 100%;
            height: 600px; /* Fixed height for chat */
            border-radius: 12px;
            background: #fff;
        }
    </style>
</head>
<body class="flex h-screen overflow-hidden selection:bg-gold-400 selection:text-black font-sans">

   <aside class="w-72 bg-surface border-r border-border flex flex-col z-50">
    <div class="p-8 pb-4">
    <a href="index.html" class="block w-fit hover:opacity-80 transition">
        <img src="assets/images/logo.svg" class="h-12 w-auto object-contain mb-2" alt="Logo">
    </a>
    <p class="text-[10px] text-gray-500 uppercase tracking-[0.2em] pl-1">System v2.1</p>
</div>

        <nav class="flex-1 mt-6 px-4 space-y-1">
            <button onclick="navigate('dashboard')" id="nav-dashboard" class="nav-item w-full flex items-center gap-4 px-4 py-3 text-gray-400 text-sm font-medium hover:text-white transition-all rounded-r-lg group active">
                <i class="ri-dashboard-line group-hover:text-gold-400"></i> Dashboard
            </button>
            <div class="mt-6 mb-2 px-4 text-[10px] font-bold text-gray-600 uppercase tracking-widest">Markets</div>
            <button onclick="navigate('global')" id="nav-global" class="nav-item w-full flex items-center gap-4 px-4 py-3 text-gray-400 text-sm font-medium hover:text-white transition-all rounded-r-lg group">
                <i class="ri-earth-line group-hover:text-gold-400"></i> Global Trade <span class="w-1.5 h-1.5 rounded-full bg-gold-400 ml-auto animate-pulse"></span>
            </button>
            <button onclick="navigate('bharat')" id="nav-bharat" class="nav-item w-full flex items-center gap-4 px-4 py-3 text-gray-400 text-sm font-medium hover:text-white transition-all rounded-r-lg group">
                <i class="ri-store-3-line group-hover:text-gold-400"></i> BharatBazar
            </button>
            <div class="mt-6 mb-2 px-4 text-[10px] font-bold text-gray-600 uppercase tracking-widest">Intelligence</div>
            <button onclick="navigate('agents')" id="nav-agents" class="nav-item w-full flex items-center gap-4 px-4 py-3 text-gray-400 text-sm font-medium hover:text-white transition-all rounded-r-lg group">
                <i class="ri-robot-2-line group-hover:text-gold-400"></i> AI Agents
            </button>
        </nav>

        <div class="p-4 border-t border-border">
            <div class="flex items-center gap-3 hover:bg-white/5 p-2 rounded-lg transition cursor-pointer">
                <div class="w-10 h-10 rounded-full bg-void border border-border flex items-center justify-center text-gray-400 overflow-hidden">
                    <img id="sidebar-dp" src="https://api.dicebear.com/7.x/initials/svg?seed=VE&backgroundColor=1a1a1a" class="w-full h-full opacity-80">
                </div>
                <div class="flex-1 overflow-hidden">
                    <div id="sidebar-name" class="text-xs font-semibold text-white truncate">Velox Exports</div>
                    <button onclick="handleLogout()" class="text-[10px] text-red-400 hover:text-red-300">Log Out</button>
                </div>
            </div>
        </div>
    </aside>

    <main class="flex-1 h-screen overflow-y-auto bg-void relative flex flex-col">
        <header class="sticky top-0 z-40 bg-void/80 backdrop-blur-md border-b border-border px-8 py-5 flex justify-between items-center shrink-0">
            <h2 id="page-title" class="text-lg font-light tracking-wide text-white">Dashboard</h2>
            <div class="flex items-center gap-6">
                <div class="flex items-center gap-2 bg-white/5 px-4 py-1.5 rounded-full border border-white/5">
                    <span class="text-[10px] text-gray-400 uppercase tracking-wider">Credits</span>
                    <span class="text-sm font-bold text-gold-400">2,450</span>
                    <button class="w-4 h-4 rounded-full bg-gold-400 text-black flex items-center justify-center text-xs hover:bg-white transition">+</button>
                </div>
                <button class="text-gray-400 hover:text-white relative"><i class="ri-notification-3-line text-xl"></i><span class="absolute top-0 right-0 w-2 h-2 bg-red-500 rounded-full"></span></button>
            </div>
        </header>

        <div id="content-area" class="p-8 max-w-7xl mx-auto w-full flex-1 flex flex-col animate-fade-in">
            </div>
    </main>

    <script>
        // --- 1. STATE & AUTH MANAGEMENT ---
        let userProfile = {
            name: "Velox Global Exports",
            location: "Mumbai Port, IN",
            trustScore: 98,
            credits: 2450,
            dp: "https://api.dicebear.com/7.x/initials/svg?seed=VE&backgroundColor=1a1a1a"
        };
        let isEditing = false;

        // ðŸŸ¢ Check Login on Load
        document.addEventListener('DOMContentLoaded', async () => {
            const { data: { session } } = await window.sb.auth.getSession();
            if (!session) {
                window.location.href = 'index.html'; // Kick out if not logged in
            } else {
                console.log("Logged in:", session.user.email);
                // Load default dashboard
                navigate('dashboard');
            }
        });

        async function handleLogout() {
            const { error } = await window.sb.auth.signOut();
            if (!error) window.location.href = 'index.html';
        }

        // --- 2. EDIT PROFILE LOGIC ---
        function toggleEdit() {
            isEditing = !isEditing;
            const editBtn = document.getElementById('edit-btn');
            
            if(isEditing) {
                editBtn.innerHTML = '<i class="ri-save-line mr-1"></i> Save Changes';
                editBtn.className = "text-xs px-3 py-1 bg-gold-400 text-black font-bold rounded hover:bg-gold-500 transition";
                document.getElementById('display-name').innerHTML = `<input type="text" id="input-name" value="${userProfile.name}" class="edit-input text-3xl font-light">`;
                document.getElementById('display-loc').innerHTML = `<input type="text" id="input-loc" value="${userProfile.location}" class="edit-input text-sm font-light w-48">`;
            } else {
                const newName = document.getElementById('input-name').value;
                const newLoc = document.getElementById('input-loc').value;
                if(newName) userProfile.name = newName;
                if(newLoc) userProfile.location = newLoc;
                
                // Update UI Sidebar
                document.getElementById('sidebar-name').innerText = userProfile.name;
                const newDp = `https://api.dicebear.com/7.x/initials/svg?seed=${userProfile.name.charAt(0)}&backgroundColor=1a1a1a`;
                userProfile.dp = newDp;
                document.getElementById('sidebar-dp').src = newDp;
                
                navigate('dashboard'); 
            }
        }

        // --- 3. HTML GENERATORS ---
        function renderTradeCard() {
            return `
            <div class="w-full h-72 rounded-xl overflow-hidden relative group border border-border glow-gold">
                <div class="absolute inset-0 group-hover:bg-black/40 transition z-10"></div>
                <img src="https://images.unsplash.com/photo-1586528116311-ad8dd3c8310d?q=80&w=2070&auto=format&fit=crop" class="absolute inset-0 w-full h-full object-cover opacity-50">
                <div class="absolute inset-0 bg-gradient-to-t from-void via-void/80 to-transparent"></div>
                <div class="absolute top-4 right-4 z-20">
                    <button id="edit-btn" onclick="toggleEdit()" class="text-xs text-gold-400 hover:text-white border border-gold-400/30 hover:border-gold-400 bg-black/50 backdrop-blur px-3 py-1 rounded transition flex items-center gap-1"><i class="ri-edit-2-line"></i> Edit Profile</button>
                </div>
                <div class="absolute bottom-0 left-0 w-full p-8 flex items-end justify-between z-20">
                    <div class="flex items-center gap-6">
                        <div class="w-24 h-24 rounded bg-black border border-gold-400/30 flex items-center justify-center overflow-hidden shadow-2xl relative group/dp">
                            <img src="${userProfile.dp}" class="w-full h-full object-cover">
                        </div>
                        <div id="trade-card-details">
                            <div class="flex items-center gap-2 mb-1">
                                <div id="display-name" class="text-3xl font-light text-white tracking-tight">${userProfile.name}</div>
                                <i class="ri-verified-badge-fill text-gold-400 text-xl"></i>
                            </div>
                            <div id="display-loc" class="text-gray-400 text-sm font-light tracking-wide">${userProfile.location} â€¢ Member</div>
                        </div>
                    </div>
                    <div class="text-right hidden md:block">
                        <div class="text-[10px] text-gray-500 uppercase tracking-widest mb-1">Trust Score</div>
                        <div class="text-3xl font-medium text-white">${userProfile.trustScore}<span class="text-base text-gray-600">/100</span></div>
                    </div>
                </div>
            </div>`;
        }

        function getDashboardHTML() {
            return `${renderTradeCard()}
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
                    <div class="glass p-6 rounded-xl border-l-2 border-l-gold-400"><div class="text-2xl font-medium text-white">Premium</div><div class="text-xs text-gray-500">Plan Status</div></div>
                    <div class="glass p-6 rounded-xl"><div class="text-2xl font-medium text-white">1,240</div><div class="text-xs text-gray-500">Profile Views</div></div>
                    <div class="glass p-6 rounded-xl"><div class="text-2xl font-medium text-white">8</div><div class="text-xs text-gray-500">Active Bids</div></div>
                </div>`;
        }

        function getGlobalMarketHTML() {
            return `
            <div class="flex justify-between items-center mb-6">
                <div class="text-gray-400 text-sm">Opportunities matched for: <span class="text-white font-bold">${userProfile.name}</span></div>
                <button class="px-3 py-1.5 text-xs text-gold-100 bg-gold-900/30 border border-gold-900 rounded">High Value Only</button>
            </div>
            <div class="space-y-4">
                <div class="glass p-6 rounded-xl relative group overflow-hidden">
                    <div class="absolute top-0 right-0 p-3"><i class="ri-lock-2-fill text-gray-600 text-xl"></i></div>
                    <div class="flex justify-between items-start">
                        <div class="flex gap-4">
                            <div class="text-3xl bg-white/5 w-12 h-12 flex items-center justify-center rounded-lg">ðŸ‡¦ðŸ‡ª</div>
                            <div><h3 class="text-base font-semibold text-white">Basmati Rice (Grade A)</h3><div class="text-xs text-gray-500 mt-0.5">Verified Buyer â€¢ Dubai</div></div>
                        </div>
                        <div class="text-gold-100 font-medium">$500k+</div>
                    </div>
                    <div class="mt-6 pt-4 border-t border-white/5 flex items-center justify-between">
                        <div class="flex items-center gap-3"><div class="w-8 h-8 rounded-full bg-surface border border-white/10 flex items-center justify-center"><i class="ri-building-2-line text-gray-500"></i></div>
                        <div class="flex flex-col"><span class="text-sm text-gray-300 blur-secret">Royal Catering LLC</span><span class="text-[10px] text-gray-600 blur-secret">contact@royal.ae</span></div></div>
                        <button class="px-6 py-2 bg-gold-400 hover:bg-gold-500 text-black text-xs font-bold rounded shadow-[0_0_15px_rgba(197,160,89,0.2)] transition flex items-center gap-2"><i class="ri-lock-unlock-line"></i> Unlock (1 Credit)</button>
                    </div>
                </div>
            </div>`;
        }

        function getBharatBazarHTML() {
            return `
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
                 <div class="border border-dashed border-white/10 rounded-xl flex flex-col items-center justify-center p-8 hover:bg-white/5 transition cursor-pointer group h-full min-h-[200px]">
                    <div class="w-12 h-12 rounded-full bg-white/5 flex items-center justify-center mb-3 group-hover:scale-110 transition"><i class="ri-add-line text-2xl text-gold-400"></i></div>
                    <span class="text-sm text-gray-400">Add Product for ${userProfile.name}</span>
                </div>
                <div class="glass p-0 rounded-xl overflow-hidden group hover:border-gold-400/30 transition">
                    <div class="h-32 bg-gray-800 relative"><img src="https://images.unsplash.com/photo-1618512496248-a07fe83aa8cb?q=80&w=1000&auto=format&fit=crop" class="w-full h-full object-cover opacity-60"><div class="absolute top-2 right-2 bg-black/60 backdrop-blur px-2 py-1 rounded text-[10px] text-white">Live</div></div>
                    <div class="p-4"><h3 class="text-white font-medium">Nashik Red Onion</h3><div class="flex justify-between items-end mt-4"><div><div class="text-[10px] text-gray-600 uppercase">Price</div><div class="text-gold-100 font-medium">â‚¹2,400</div></div><div class="text-right"><div class="text-[10px] text-gray-600 uppercase">Qty</div><div class="text-white">50T</div></div></div></div>
                </div>
            </div>`;
        }

        // --- 4. AGENTS ---
        const agentIframe1 = "https://app.relevanceai.com/agents/d7b62b/18dd64bb-7e6f-4d82-913c-42ffa5f552c1/1733a3cb-bd12-45c6-9cbc-71e1286652fe/embed-chat?hide_tool_steps=true&bubble_style=agent&primary_color=%23000000&input_placeholder_text=Ask+legal+questions...";
        const agentIframe2 = "https://app.relevanceai.com/agents/d7b62b/3fdb8425-c0a5-4909-9513-21d07c9f8f99/a3f0bb17-9cbf-4d17-88cc-c1a981deabdd/embed-chat?bubble_style=agent&primary_color=%23685FFF&input_placeholder_text=Ask+about+logistics...";

        function getAgentsGridHTML() {
            return `
            <div class="space-y-6">
                <div class="text-center mb-8">
                    <h3 class="text-xl text-white font-light">Select Your AI Agent</h3>
                    <p class="text-gray-500 text-sm">Deploy specialized autonomous agents.</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div onclick="openAgent('legal')" class="glass p-6 rounded-xl hover:bg-white/5 hover:border-gold-400/50 cursor-pointer transition group text-center relative overflow-hidden">
                        <div class="absolute top-2 right-2 flex gap-1"><span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span></div>
                        <div class="w-16 h-16 rounded-full bg-blue-900/20 text-blue-400 flex items-center justify-center mx-auto mb-4 border border-blue-500/20 group-hover:scale-110 transition"><i class="ri-scales-3-line text-2xl"></i></div>
                        <h4 class="text-white font-medium mb-1">Legal & HS Code</h4>
                        <p class="text-gray-500 text-xs px-2">Export compliance checks.</p>
                        <button class="mt-4 text-xs text-blue-400 border border-blue-400/30 px-4 py-1.5 rounded hover:bg-blue-400 hover:text-black transition">Launch Agent</button>
                    </div>
                    <div onclick="openAgent('govtech')" class="glass p-6 rounded-xl hover:bg-white/5 hover:border-gold-400/50 cursor-pointer transition group text-center relative overflow-hidden">
                         <div class="absolute top-2 right-2 flex gap-1"><span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span></div>
                        <div class="w-16 h-16 rounded-full bg-purple-900/20 text-purple-400 flex items-center justify-center mx-auto mb-4 border border-purple-500/20 group-hover:scale-110 transition"><i class="ri-government-line text-2xl"></i></div>
                        <h4 class="text-white font-medium mb-1">GovTech & Maritime</h4>
                        <p class="text-gray-500 text-xs px-2">Port logistics & DGFT.</p>
                        <button class="mt-4 text-xs text-purple-400 border border-purple-400/30 px-4 py-1.5 rounded hover:bg-purple-400 hover:text-black transition">Launch Agent</button>
                    </div>
                </div>
            </div>`;
        }

        function openAgent(type) {
            let url = (type === 'legal') ? agentIframe1 : agentIframe2;
            let title = (type === 'legal') ? "Legal & HS Code Advisor" : "GovTech & Maritime Assistant";

            document.getElementById('page-title').innerText = title;
            document.getElementById('content-area').innerHTML = `
                <div class="flex flex-col h-full animate-fade-in">
                    <div class="flex items-center justify-between mb-4">
                        <button onclick="navigate('agents')" class="flex items-center gap-2 text-sm text-gray-400 hover:text-white transition"><i class="ri-arrow-left-line"></i> Back to Agents</button>
                        <div class="flex gap-2"><span class="flex h-2 w-2 relative"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span><span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span></span><span class="text-xs text-green-400">Agent Active</span></div>
                    </div>
                    <div class="flex-1 rounded-xl overflow-hidden border border-border bg-white">
                        <iframe src="${url}" class="agent-frame" frameborder="0" allow="microphone"></iframe>
                    </div>
                </div>`;
        }

        // --- 5. NAVIGATION CONTROLLER ---
        function navigate(pageId) {
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.getElementById(`nav-${pageId}`).classList.add('active');
            
            const contentArea = document.getElementById('content-area');
            const pageTitle = document.getElementById('page-title');
            
            contentArea.style.opacity = '0';
            setTimeout(() => {
                switch(pageId) {
                    case 'dashboard': 
                        pageTitle.innerText = "Command Center";
                        contentArea.innerHTML = getDashboardHTML(); 
                        break;
                    case 'global': 
                        pageTitle.innerText = "Global Opportunities";
                        contentArea.innerHTML = getGlobalMarketHTML(); 
                        break;
                    case 'bharat': 
                        pageTitle.innerText = "BharatBazar Inventory";
                        contentArea.innerHTML = getBharatBazarHTML(); 
                        break;
                    case 'agents': 
                        pageTitle.innerText = "AI Agent Grid";
                        contentArea.innerHTML = getAgentsGridHTML(); 
                        break;
                }
                contentArea.classList.remove('animate-fade-in');
                void contentArea.offsetWidth;
                contentArea.classList.add('animate-fade-in');
                contentArea.style.opacity = '1';
            }, 200);
        }
    </script>
</body>
</html>