<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus Trade - Debugger</title>
    <style>
        body { font-family: sans-serif; background: #0f172a; color: white; display: flex; flex-direction: column; height: 100vh; margin: 0; }
        .chat-container { flex: 1; padding: 20px; max-width: 800px; margin: 0 auto; width: 100%; }
        #chatBox { flex: 1; overflow-y: auto; border: 1px solid #334155; padding: 20px; background: #1e293b; margin-bottom: 20px; }
        .msg { padding: 10px; border-radius: 8px; margin-bottom: 10px; }
        .bot { background: #334155; border-left: 4px solid #38bdf8; }
        .error { background: #450a0a; border-left: 4px solid #ef4444; color: #fca5a5; }
        input { padding: 15px; width: 70%; background: #334155; color: white; border: none; }
        button { padding: 15px; width: 25%; background: #38bdf8; border: none; cursor: pointer; }
    </style>
</head>
<body>

    <h2 style="text-align: center; color: #ef4444;">DEBUG MODE (Error Finder)</h2>

    <div class="chat-container">
        <div id="chatBox">
            <div class="msg bot">System Ready. Send message to check API status.</div>
        </div>
        <div>
            <input type="text" id="userInput" placeholder="Type generic test..." value="Hi">
            <button onclick="startChat()">Test Connection</button>
        </div>
    </div>

    <script>
        // --- ⚠️ CHECK YOUR CREDENTIALS HERE ---
        const CONFIG = {
            // Yahan check karo ki key sahi format mein hai (ProjectID:APIKey)
            AUTH: "3fdb8425-c0a5-4909-9513-21d07c9f8f99:sk-NmQwOGI3YmMtMzljYy00NTAwLTgwYTUtYzE0NzRiYzA0N2Rh",
            
            AGENT_ID: "a3f0bb17-9cbf-4d17-88cc-c1a981deabdd",
            
            TRIGGER_URL: "https://api-d7b62b.stack.tryrelevance.com/latest/agents/trigger",
            POLL_BASE: "https://api-d7b62b.stack.tryrelevance.com/latest/jobs"
        };

        async function startChat() {
            const input = document.getElementById("userInput");
            const text = input.value;
            
            addMsg("Sending Request...", 'bot');

            try {
                const response = await fetch(CONFIG.TRIGGER_URL, {
                    method: "POST",
                    headers: { 
                        "Authorization": CONFIG.AUTH, 
                        "Content-Type": "application/json" 
                    },
                    body: JSON.stringify({ 
                        message: { role: "user", content: text }, 
                        agent_id: CONFIG.AGENT_ID 
                    })
                });

                const data = await response.json();
                console.log("Server Response:", data); // F12 Console ke liye

                // --- ERROR CATCHING LOGIC ---
                if (data.job_info && data.job_info.job_id) {
                    addMsg("✅ Success! Job ID received: " + data.job_info.job_id, 'bot');
                    addMsg("Polling function will start now...", 'bot');
                    // Polling code hataya hai taaki hum sirf Connection test karein
                } else {
                    // YAHAN DIKHEGA ASLI ERROR
                    let errorText = "❌ <b>SERVER ERROR:</b><br>";
                    
                    if (data.detail) errorText += JSON.stringify(data.detail);
                    else if (data.message) errorText += data.message;
                    else errorText += JSON.stringify(data);

                    addMsg(errorText, 'error');
                }

            } catch (e) {
                addMsg("❌ NETWORK ERROR: " + e.message, 'error');
            }
        }

        function addMsg(text, type) {
            const box = document.getElementById("chatBox");
            const div = document.createElement("div");
            div.className = `msg ${type}`;
            div.innerHTML = text;
            box.appendChild(div);
        }
    </script>
</body>
</html>
