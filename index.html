<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="HindTradeAI - Agent-Led Trade Network. Verify exporters, automate compliance, find buyers, track shipments with AI.">
    <title>HindTradeAI - The Global Trade OS</title>
    
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            color: #e5e7eb;
            line-height: 1.6;
            background: radial-gradient(circle at top, #0b1220 0%, #020617 40%, #000000 100%);
            min-height: 100vh;
        }

        /* Header */
        header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(11, 18, 32, 0.85);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(148, 163, 184, 0.25);
            padding: 16px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, #38bdf8 0%, #22c55e 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-buttons {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .btn-header {
            padding: 8px 20px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
        }

        .btn-secondary {
            background: rgba(56, 189, 248, 0.1);
            color: #38bdf8;
            border: 1px solid rgba(56, 189, 248, 0.3);
        }

        .btn-secondary:hover {
            background: rgba(56, 189, 248, 0.2);
            border-color: rgba(56, 189, 248, 0.5);
        }

        .btn-primary {
            background: linear-gradient(135deg, #38bdf8 0%, #22c55e 100%);
            color: #020617;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(56, 189, 248, 0.3);
        }

        /* Hero Section */
        .hero {
            max-width: 1400px;
            margin: 0 auto;
            padding: 80px 40px;
            text-align: center;
        }

        .hero h1 {
            font-size: 56px;
            font-weight: 700;
            color: #f9fafb;
            margin-bottom: 20px;
            line-height: 1.2;
        }

        .hero .gradient-text {
            background: linear-gradient(135deg, #38bdf8 0%, #22c55e 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero p {
            font-size: 18px;
            color: #9ca3af;
            margin-bottom: 40px;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }

        .hero-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-large {
            padding: 14px 40px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
        }

        .btn-primary-large {
            background: linear-gradient(135deg, #38bdf8 0%, #22c55e 100%);
            color: #020617;
        }

        .btn-primary-large:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 30px rgba(56, 189, 248, 0.4);
        }

        .btn-outline-large {
            background: transparent;
            border: 2px solid rgba(56, 189, 248, 0.3);
            color: #38bdf8;
        }

        .btn-outline-large:hover {
            border-color: rgba(56, 189, 248, 0.6);
            background: rgba(56, 189, 248, 0.1);
        }

        /* Features Grid */
        .features {
            max-width: 1400px;
            margin: 80px auto;
            padding: 0 40px;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
        }

        .feature-card {
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid rgba(56, 189, 248, 0.2);
            border-radius: 12px;
            padding: 30px;
            transition: all 0.3s;
        }

        .feature-card:hover {
            border-color: rgba(56, 189, 248, 0.5);
            background: rgba(15, 23, 42, 0.8);
            transform: translateY(-4px);
        }

        .feature-icon {
            font-size: 32px;
            margin-bottom: 16px;
        }

        .feature-card h3 {
            color: #f9fafb;
            margin-bottom: 12px;
            font-size: 18px;
        }

        .feature-card p {
            color: #9ca3af;
            font-size: 14px;
            margin: 0;
        }

        /* CTA Section */
        .cta-section {
            max-width: 900px;
            margin: 100px auto;
            padding: 60px 40px;
            background: linear-gradient(135deg, rgba(56, 189, 248, 0.1) 0%, rgba(34, 197, 94, 0.1) 100%);
            border: 1px solid rgba(56, 189, 248, 0.2);
            border-radius: 16px;
            text-align: center;
        }

        .cta-section h2 {
            color: #f9fafb;
            font-size: 36px;
            margin-bottom: 20px;
        }

        .cta-section p {
            color: #9ca3af;
            font-size: 16px;
            margin-bottom: 30px;
        }

        /* Footer */
        footer {
            max-width: 1400px;
            margin: 80px auto 0;
            padding: 40px;
            border-top: 1px solid rgba(148, 163, 184, 0.25);
            text-align: center;
            color: #6b7280;
        }

        /* Registration Modal */
        #registrationModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.95) 0%, rgba(15, 23, 42, 0.98) 100%);
            border: 1px solid rgba(56, 189, 248, 0.3);
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            padding: 40px;
            position: relative;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(56, 189, 248, 0.2);
            border: 1px solid rgba(56, 189, 248, 0.5);
            color: #38bdf8;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 24px;
            transition: all 0.3s;
            font-weight: 300;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: rgba(56, 189, 248, 0.3);
        }

        .registration-step {
            animation: fadeIn 0.3s ease-out;
        }

        .step-title {
            color: #f9fafb;
            margin-bottom: 10px;
            font-size: 28px;
            font-weight: 700;
        }

        .step-subtitle {
            color: #9ca3af;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: #9ca3af;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 12px 14px;
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 8px;
            color: #f9fafb;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.3s;
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            background: rgba(15, 23, 42, 0.8);
            border-color: rgba(56, 189, 248, 0.5);
            box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.1);
        }

        .form-input::placeholder,
        .form-textarea::placeholder {
            color: rgba(156, 163, 175, 0.5);
        }

        .form-textarea {
            resize: none;
            min-height: 60px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .btn-submit {
            width: 100%;
            padding: 12px 20px;
            background: linear-gradient(135deg, #38bdf8 0%, #22c55e 100%);
            color: #020617;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(56, 189, 248, 0.3);
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(56, 189, 248, 0.4);
        }

        .success-message {
            text-align: center;
        }

        .success-icon {
            font-size: 64px;
            margin-bottom: 20px;
            animation: scaleIn 0.5s ease-out;
        }

        .trade-card-display {
            background: rgba(56, 189, 248, 0.1);
            border: 1px solid rgba(56, 189, 248, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .trade-card-label {
            color: #9ca3af;
            font-size: 13px;
            margin-bottom: 8px;
        }

        .trade-card-id {
            color: #38bdf8;
            font-size: 18px;
            font-weight: 600;
            font-family: monospace;
            word-break: break-all;
        }

        .resend-link {
            text-align: center;
            color: #6b7280;
            font-size: 13px;
            margin-top: 10px;
        }

        .resend-link a {
            color: #38bdf8;
            text-decoration: none;
            font-weight: 600;
        }

        .resend-link a:hover {
            text-decoration: underline;
        }

        .loading-spinner {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 3000;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(56, 189, 248, 0.2);
            border-top: 3px solid #38bdf8;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes scaleIn {
            from { transform: scale(0); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        /* Responsive */
        @media (max-width: 768px) {
            header {
                padding: 12px 20px;
            }

            .hero {
                padding: 40px 20px;
            }

            .hero h1 {
                font-size: 36px;
            }

            .hero p {
                font-size: 16px;
            }

            .features {
                padding: 0 20px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .modal-content {
                width: 95%;
                padding: 30px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="logo">üåê HindTradeAI</div>
        <div class="nav-buttons">
            <button class="btn-header btn-secondary" onclick="alert('Login coming soon!')">Login</button>
            <button class="btn-header btn-primary" onclick="openRegistrationModal()">Register</button>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <h1>
            The <span class="gradient-text">Agent-Led Trade Network</span>
        </h1>
        <p>7 AI Agents automate your entire export journey. Verify exporters, automate compliance, find buyers, track shipments with one platform.</p>
        
        <div class="hero-buttons">
            <button class="btn-large btn-primary-large" onclick="openRegistrationModal()">
                ü§ñ Get Started Now
            </button>
            <button class="btn-large btn-outline-large" onclick="alert('Demo coming soon!')">
                üì∫ Watch Demo
            </button>
        </div>
    </section>

    <!-- Features Section -->
    <section class="features">
        <div class="features-grid">
            <div class="feature-card">
                <div class="feature-icon">‚úÖ</div>
                <h3>Verify Exporters</h3>
                <p>AI-powered verification system to check exporter credentials and compliance status in real-time.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">‚öôÔ∏è</div>
                <h3>Automate Compliance</h3>
                <p>Automatic compliance checks, documentation, and regulatory requirement management.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üåç</div>
                <h3>Find Buyers</h3>
                <p>AI matching system to connect you with verified international buyers for your products.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üìä</div>
                <h3>Track Shipments</h3>
                <p>Real-time shipment tracking, logistics optimization, and delivery management.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üíº</div>
                <h3>CA Connect</h3>
                <p>Direct connection with certified Chartered Accountants for financial & tax advice.</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">ü§ù</div>
                <h3>Network Effect</h3>
                <p>Join a growing community of exporters, importers, and trade professionals.</p>
            </div>
        </div>
    </section>

    <!-- CTA Section -->
    <section class="cta-section">
        <h2>Ready to Scale Your Trade?</h2>
        <p>Join thousands of exporters using HindTradeAI to grow their business globally.</p>
        <button class="btn-large btn-primary-large" onclick="openRegistrationModal()">
            Get Your Trade Card Now
        </button>
    </section>

    <!-- Footer -->
    <footer>
        <p>&copy; 2024 HindTradeAI. All rights reserved. | <a href="#" style="color: #38bdf8; text-decoration: none;">Privacy</a> | <a href="#" style="color: #38bdf8; text-decoration: none;">Terms</a></p>
    </footer>

    <!-- ========================================
         REGISTRATION MODAL & FORM
         ======================================== -->

    <div id="registrationModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeRegistrationModal()">√ó</button>

            <!-- STEP 1: SIGN UP -->
            <div id="step1SignUp" class="registration-step">
                <h2 class="step-title">Create Account</h2>
                <p class="step-subtitle">Join HindTradeAI - Get verified in 48 hours</p>
                
                <form id="signupForm" onsubmit="handleSignup(event)">
                    <div class="form-group">
                        <label class="form-label">Full Name</label>
                        <input type="text" id="fullName" class="form-input" placeholder="Your Full Name" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Company Name</label>
                        <input type="text" id="companyName" class="form-input" placeholder="Your Company Name" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Email Address</label>
                        <input type="email" id="email" class="form-input" placeholder="you@company.com" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Phone Number</label>
                        <input type="tel" id="phone" class="form-input" placeholder="+91-98765-43210" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" id="password" class="form-input" placeholder="Min 8 characters" required minlength="8">
                        <small style="color: #6b7280; margin-top: 4px; display: block;">Minimum 8 characters</small>
                    </div>
                    
                    <button type="submit" class="btn-submit">Create Account</button>
                </form>
            </div>

            <!-- STEP 2: EMAIL VERIFICATION -->
            <div id="step2Verify" class="registration-step" style="display: none;">
                <h2 class="step-title">Verify Email</h2>
                <p class="step-subtitle">Enter the 6-digit code sent to your email</p>
                
                <form id="verificationForm" onsubmit="handleVerification(event)">
                    <div class="form-group">
                        <label class="form-label">Verification Code</label>
                        <input type="text" id="verificationCode" class="form-input" placeholder="123456" maxlength="6" required style="text-align: center; font-size: 20px; letter-spacing: 5px; font-family: monospace;">
                    </div>
                    
                    <button type="submit" class="btn-submit">Verify Email</button>
                </form>
                
                <div class="resend-link">
                    Didn't receive code? <a href="#" onclick="resendCode(); return false;">Resend</a>
                </div>
            </div>

            <!-- STEP 3: CREATE PROFILE -->
            <div id="step3Profile" class="registration-step" style="display: none;">
                <h2 class="step-title">Create Profile</h2>
                <p class="step-subtitle">Complete your business information</p>
                
                <form id="profileForm" onsubmit="handleProfileSetup(event)">
                    <div class="form-group">
                        <label class="form-label">GST Number</label>
                        <input type="text" id="gstNumber" class="form-input" placeholder="18AABCU1234H1Z0">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">IEC Number</label>
                        <input type="text" id="iecNumber" class="form-input" placeholder="0990123456">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">PAN Number</label>
                        <input type="text" id="panNumber" class="form-input" placeholder="AABCU1234H">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Company Address</label>
                        <textarea id="address" class="form-textarea" placeholder="123 Business Street" required></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">City</label>
                            <input type="text" id="city" class="form-input" placeholder="Ludhiana" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">State</label>
                            <input type="text" id="state" class="form-input" placeholder="Punjab" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Business Category</label>
                        <select id="businessCategory" class="form-select" required>
                            <option value="" disabled selected>Select category</option>
                            <option value="manufacturing">Manufacturing</option>
                            <option value="export">Export</option>
                            <option value="import">Import</option>
                            <option value="trading">Trading</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Annual Turnover</label>
                        <select id="annualTurnover" class="form-select" required>
                            <option value="" disabled selected>Select range</option>
                            <option value="0-50L">‚Çπ0 - ‚Çπ50 Lakhs</option>
                            <option value="50L-1Cr">‚Çπ50 Lakhs - ‚Çπ1 Crore</option>
                            <option value="1Cr-5Cr">‚Çπ1 - ‚Çπ5 Crore</option>
                            <option value="5Cr+">‚Çπ5 Crore+</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="btn-submit">Create Trade Card</button>
                </form>
            </div>

            <!-- STEP 4: SUCCESS -->
            <div id="step4Success" class="registration-step" style="display: none;">
                <div class="success-message">
                    <div class="success-icon">‚ú®</div>
                    <h2 class="step-title">Registration Successful!</h2>
                    <p class="step-subtitle">Your account is being verified</p>
                    
                    <div class="trade-card-display">
                        <p class="trade-card-label">Trade Card ID:</p>
                        <p class="trade-card-id" id="tradeCardId"></p>
                    </div>
                    
                    <p style="color: #6b7280; font-size: 13px; margin-bottom: 20px;">
                        Your verification will be completed in 48 hours. You'll receive an email confirmation.
                    </p>
                    
                    <button class="btn-submit" onclick="closeRegistrationModal()">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div id="loadingSpinner" class="loading-spinner">
        <div class="spinner"></div>
    </div>

    <!-- ========================================
         JAVASCRIPT - REGISTRATION & SUPABASE
         ======================================== -->
    <script>
        // ============================================
        // SUPABASE CONFIGURATION
        // ============================================
        
        const SUPABASE_URL = "https://fgzlekquexmtnzrhjswd.supabase.co";
        const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZnemxla3F1ZXhtdG56cmhqc3dkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY5NDgxNTQsImV4cCI6MjA4MjUyNDE1NH0.hEDqZzidfJJTE5n0KF2Jd1XNMSbDyZcut4MP-PCi1NY";
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        console.log('‚úÖ Supabase initialized!');
        console.log('üîó URL:', SUPABASE_URL);

        // ============================================
        // REGISTRATION STATE
        // ============================================
        
        let registrationState = {
            step: 1,
            formData: {},
            verificationCode: Math.random().toString().slice(2, 8)
        };

        // ============================================
        // MODAL FUNCTIONS
        // ============================================
        
        function openRegistrationModal() {
            document.getElementById('registrationModal').style.display = 'flex';
            document.body.style.overflow = 'hidden';
            showStep(1);
        }

        function closeRegistrationModal() {
            document.getElementById('registrationModal').style.display = 'none';
            document.body.style.overflow = 'auto';
            registrationState = {
                step: 1,
                formData: {},
                verificationCode: Math.random().toString().slice(2, 8)
            };
        }

        function showStep(stepNumber) {
            const steps = document.querySelectorAll('.registration-step');
            steps.forEach(step => step.style.display = 'none');
            
            const stepId = [
                'step1SignUp',
                'step2Verify',
                'step3Profile',
                'step4Success'
            ][stepNumber - 1];
            
            if (document.getElementById(stepId)) {
                document.getElementById(stepId).style.display = 'block';
            }
        }

        // ============================================
        // SIGNUP HANDLER
        // ============================================
        
        async function handleSignup(event) {
            event.preventDefault();
            
            const fullName = document.getElementById('fullName').value;
            const companyName = document.getElementById('companyName').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            const password = document.getElementById('password').value;

            registrationState.formData = {
                fullName,
                companyName,
                email,
                phone,
                password
            };

            try {
                showLoading(true);

                // Try to save to Supabase
                if (typeof supabase !== 'undefined') {
                    const { data, error } = await supabase
                        .from('users')
                        .insert({
                            email: email,
                            full_name: fullName,
                            company_name: companyName,
                            phone: phone,
                            status: 'pending'
                        })
                        .select();

                    if (error) {
                        if (error.code === '23505') {
                            alert('‚ùå Email already registered. Please use a different email.');
                            showLoading(false);
                            return;
                        }
                        throw error;
                    }

                    registrationState.formData.userId = data.id;
                    console.log('‚úÖ User saved to Supabase');
                }

                // Show verification code
                alert(`üìß Verification Code: ${registrationState.verificationCode}\n\n(In production, this will be sent to your email)`);

                showLoading(false);
                registrationState.step = 2;
                showStep(2);

            } catch (error) {
                showLoading(false);
                console.error('Signup error:', error);
                alert('‚ùå Registration failed: ' + error.message);
            }
        }

        // ============================================
        // VERIFICATION HANDLER
        // ============================================
        
        function handleVerification(event) {
            event.preventDefault();

            const enteredCode = document.getElementById('verificationCode').value;

            if (enteredCode === registrationState.verificationCode) {
                registrationState.step = 3;
                showStep(3);
            } else {
                alert('‚ùå Invalid verification code. Please try again.');
            }
        }

        function resendCode() {
            registrationState.verificationCode = Math.random().toString().slice(2, 8);
            alert(`üìß New Code: ${registrationState.verificationCode}`);
        }

        // ============================================
        // PROFILE SETUP HANDLER
        // ============================================
        
        async function handleProfileSetup(event) {
            event.preventDefault();

            const profile = {
                gstNumber: document.getElementById('gstNumber').value,
                iecNumber: document.getElementById('iecNumber').value,
                panNumber: document.getElementById('panNumber').value,
                address: document.getElementById('address').value,
                city: document.getElementById('city').value,
                state: document.getElementById('state').value,
                businessCategory: document.getElementById('businessCategory').value,
                annualTurnover: document.getElementById('annualTurnover').value
            };

            try {
                showLoading(true);

                // Generate Trade Card ID
                const tradeCardId = `HT-${profile.city.slice(0, 3).toUpperCase()}-${new Date().getFullYear()}-${String(Math.floor(Math.random() * 10000)).padStart(4, '0')}`;

                // Save to Supabase
                if (typeof supabase !== 'undefined' && registrationState.formData.userId) {
                    const { data, error } = await supabase
                        .from('user_profiles')
                        .insert({
                            user_id: registrationState.formData.userId,
                            gst_number: profile.gstNumber,
                            iec_number: profile.iecNumber,
                            pan_number: profile.panNumber,
                            address: profile.address,
                            city: profile.city,
                            state: profile.state,
                            business_category: profile.businessCategory,
                            annual_turnover: profile.annualTurnover,
                            trade_card_id: tradeCardId
                        })
                        .select();

                    if (error) throw error;
                    console.log('‚úÖ Profile saved to Supabase');
                }

                showLoading(false);

                // Show success
                document.getElementById('tradeCardId').textContent = tradeCardId;
                registrationState.step = 4;
                showStep(4);

            } catch (error) {
                showLoading(false);
                console.error('Profile error:', error);
                alert('‚ùå Profile setup failed: ' + error.message);
            }
        }

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        
        function showLoading(show) {
            document.getElementById('loadingSpinner').style.display = show ? 'block' : 'none';
        }

        // Close modal on Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') closeRegistrationModal();
        });

        // Test Supabase connection
        async function testSupabaseConnection() {
            try {
                const { data, error } = await supabase.from('users').select('count', { count: 'exact' });
                if (error) throw error;
                console.log('‚úÖ Supabase database connection successful!');
            } catch (error) {
                console.error('‚ùå Supabase connection error:', error);
            }
        }

        // Test on page load
        window.addEventListener('load', testSupabaseConnection);

        console.log('‚úÖ All registration functions loaded!');
    </script>
</body>
</html>
